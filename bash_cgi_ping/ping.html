<!DOCTYPE html>
<html>
<head>
<meta charset='UTF-8'> 

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>

<script>
$(document).ready(function(){

		// Array to hold all the valid IPs in the hosts file
		var IPs = [];

		// Ping each IP in the hosts file
		function ping(){
			$.each(IPs, function(index, value){
				$.ajax('http://localhost/cgi-bin/ping?' + value);
			});
		};

		// AJAX complete handler
		$(document).ajaxComplete(function(event, request, settings) {

			// Handle pings
			if (RegExp('ping').test(settings.url)) {

				// Check result
				var color = 'red';
				if (request.responseText == 1)
					color = 'green';

				// Extract the IP from the request
				var ip = settings.url.split('?').pop();

				// Create an ID to target the span
				var id = ip.replace(/\./g, '_');
				$('span#' + id).css('color', color);

			} else {

				// Otherwise it must be the hosts file request, extract hosts
				var hosts = request.responseText.split('\n');

				// Iterate through each IP in the hosts file
				for (var i = 0; i < hosts.length; ++i) {

					// Extract IPs
					var _ip = 'comment';
					var ip = RegExp('^[0-9\.]{7,}').exec(hosts[i]);

					// If it looks like an IP then store it
					if (ip) {
						IPs.push(ip);

						// Create an ID to target the correct span
						var id = ip[0].replace(/\./g, '_');
					}

					// Create a span for each line
					$('p#hosts').append('<span id=' + id + '>' + hosts[i] + '</span><br>');
				}

				// Initiate ping once the HTML has been populated
				ping();
			}
		});

		// Update cycle
		setInterval(function() {
			$('p#timestamp').text(new Date);
			ping();
		}, 2000);

		// Create page elements
		$('body').append('<p id=timestamp>tbc</p>');
		$('body').append('<p id=hosts></p>');

		// Initialise timestamp
		$('p#timestamp').text(new Date);

		// Fetch hosts file
		$.ajax('hosts');
});
</script>

</head>
<body style='background-color: black; color: grey; font-family: monospace;'>
<!-- To see here nothing -->
</body>
</html>
